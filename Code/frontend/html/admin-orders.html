<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Manage Orders</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <div class="container">
    <h1>Manage Orders</h1>
    <table border="1" width="100%" cellpadding="8" id="orders-table">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer ID</th>
          <th>Total Amount</th>
          <th>Status</th>
          <th>Update</th>
        </tr>
      </thead>
      <tbody>
        <!-- Orders will load here -->
      </tbody>
    </table>
  </div>

  <script src="../js/config.js"></script>
  <script>
    async function loadOrders() {
      try {
        const response = await fetch(apiUrl("orders")); // ✅ admin fetch all
        const result = await response.json();

        if (result.status !== "success") {
          throw new Error(result.message || "Failed to fetch orders");
        }

        const orders = result.data;

        const tbody = document.querySelector("#orders-table tbody");
        tbody.innerHTML = orders.map(order => `
          <tr>
            <td>${order.order_id}</td>
            <td>${order.customer_id}</td>
            <td>₱${order.total_amount}</td>
            <td>${order.order_status}</td>
            <td>
              <select onchange="updateOrder(${order.order_id}, this.value)">
                <option value="">-- Select --</option>
                <option value="completed">Completed</option>
                <option value="refunded">Refunded</option>
                <option value="returned">Returned</option>
              </select>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        console.error("Failed to load orders:", error);
      }
    }

    async function updateOrder(orderId, newStatus) {
      if (!newStatus) return;

      try {
        const response = await fetch(apiUrl("orderUpdate"), {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ order_id: orderId, status: newStatus })
        });

        const result = await response.json();
        alert(result.message);
        loadOrders(); // reload updated list
      } catch (error) {
        console.error("Failed to update order:", error);
      }
    }

    document.addEventListener("DOMContentLoaded", loadOrders);
  </script>
</body>
</html>
